const canvas=document.querySelector("canvas"),ctx=canvas.getContext("2d"),control=document.getElementsByClassName("control")[0],credits=document.getElementsByClassName("credits")[0];let[spawn,strategy,population,hitboxes,lines]=["factionsSpawn","attackHide",100,!1,!1];const rock=new Image;rock.src="assets/rock.png";const paper=new Image;paper.src="assets/paper.png";const scissors=new Image;scissors.src="assets/scissors.png";const assets=[rock,paper,scissors];let players=[];class Player{constructor(t,e,s){this.x=t,this.y=e,this.type=s,this.width=30,this.height=30,this.hitbox=15}collide(t){let e=this.hitbox+t.hitbox,s=this.x-t.x,a=this.y-t.y;return e>Math.sqrt(s*s+a*a)}isKillable(t){return("rock"!=this.type||"rock"!=t.type)&&("rock"!=this.type||"paper"!=t.type)&&("rock"==this.type&&"scissors"==t.type||"paper"==this.type&&"rock"==t.type||("paper"!=this.type||"paper"!=t.type)&&("paper"!=this.type||"scissors"!=t.type)&&("scissors"!=this.type||"rock"!=t.type)&&("scissors"==this.type&&"paper"==t.type||("scissors"!=this.type||"scissors"!=t.type)&&void 0))}isEnemy(t){return("rock"!=this.type||"rock"!=t.type)&&("rock"==this.type&&"paper"==t.type||("rock"!=this.type||"scissors"!=t.type)&&("paper"!=this.type||"rock"!=t.type)&&("paper"!=this.type||"paper"!=t.type)&&("paper"==this.type&&"scissors"==t.type||"scissors"==this.type&&"rock"==t.type||("scissors"!=this.type||"paper"!=t.type)&&("scissors"!=this.type||"scissors"!=t.type)&&void 0))}draw(){let t=assets[["rock","paper","scissors"].indexOf(this.type)];ctx.drawImage(t,this.x-this.width/2,this.y-this.height/2,this.width,this.height),hitboxes&&(ctx.beginPath(),ctx.strokeStyle="black",ctx.arc(this.x,this.y,this.hitbox,0,2*Math.PI),ctx.stroke())}closestKillable(){let t,e;return players.forEach(s=>{if(s==this)return;let a=this.x-s.x,i=this.y-s.y,n=Math.sqrt(a*a+i*i);(!e||n<e)&&this.isKillable(s)&&(t=s,e=n)}),[t,e]}closestEnemy(){let t,e;return players.forEach(s=>{if(s==this)return;let a=this.x-s.x,i=this.y-s.y,n=Math.sqrt(a*a+i*i);(!e||n<e)&&this.isEnemy(s)&&(t=s,e=n)}),[t,e]}move(){if("attackHide"==strategy){let t=this.closestKillable(),e=this.closestEnemy();if(t[0]&&(t[1]<e[1]||!e[0])){lines&&(ctx.beginPath(),ctx.strokeStyle="green",ctx.moveTo(this.x,this.y),ctx.lineTo(t[0].x,t[0].y),ctx.stroke());let s=180*Math.atan2(t[0].y-this.y,t[0].x-this.x)/Math.PI;this.x+=1.2*Math.cos(s*(Math.PI/180)),this.y+=1.2*Math.sin(s*(Math.PI/180))}if(e[0]&&(e[1]<t[1]||!t[0]&&e[1]<100)){lines&&(ctx.beginPath(),ctx.strokeStyle="red",ctx.moveTo(this.x,this.y),ctx.lineTo(e[0].x,e[0].y),ctx.stroke());let a=180*Math.atan2(e[0].y-this.y,e[0].x-this.x)/Math.PI+180,i=this.x+Math.cos(a*(Math.PI/180)),n=this.y+Math.sin(a*(Math.PI/180));i<canvas.width&&i>0&&(this.x+=.5*Math.cos(a*(Math.PI/180))),n<canvas.height&&n>0&&(this.y+=.5*Math.sin(a*(Math.PI/180)))}}else{let r=players[Math.floor(randomNum(0,players.length-1))];lines&&(ctx.beginPath(),ctx.strokeStyle="grey",ctx.moveTo(this.x,this.y),ctx.lineTo(r.x,r.y),ctx.stroke());let c=180*Math.atan2(r.y-this.y,r.x-this.x)/Math.PI;this.x+=.5*Math.cos(c*(Math.PI/180)),this.y+=.5*Math.sin(c*(Math.PI/180))}let o=this.x+randomNum(-3,3),h=this.y+randomNum(-3,3);o<canvas.width&&o>0&&(this.x+=randomNum(-2,2)),h<canvas.height&&h>0&&(this.y+=randomNum(-2,2))}change(){players.forEach(t=>{this.collide(t)&&this.isKillable(t)&&(t.type=this.type)})}}function randomNum(t,e){return Math.random()*(e-t)+t}function gameWon(){let t,e=!0;return players.forEach(s=>{if(!t){t=s.type;return}s.type!=t&&(e=!1)}),[e,t]}function startGame(){if(population<3&&(population=3),hitboxes=document.getElementsByTagName("input")[4].checked,lines=document.getElementsByTagName("input")[5].checked,players=[],resize(),control.style.display="none",credits.style.display="none","factionsSpawn"==spawn){let t=population,e=[[randomNum(0,canvas.width),randomNum(0,canvas.height)],[randomNum(0,canvas.width),randomNum(0,canvas.height)],[randomNum(0,canvas.width),randomNum(0,canvas.height)]];function s(){let s=[randomNum(0,canvas.width),randomNum(0,canvas.width)],a,i=s[0]-e[0][0],n=s[1]-e[0][1];for(a=Math.sqrt(i*i+n*n);a>t||s[0]<0||s[0]>canvas.width||s[1]>canvas.height||s[1]<0;){s=[randomNum(0,canvas.width),randomNum(0,canvas.width)];let r=s[0]-e[0][0],c=s[1]-e[0][1],o=Math.sqrt(r*r+c*c);a=o}players.push(new Player(s[0],s[1],"rock"))}function a(){let s=[randomNum(0,canvas.width),randomNum(0,canvas.width)],a,i=s[0]-e[1][0],n=s[1]-e[1][1];for(a=Math.sqrt(i*i+n*n);a>t||s[0]<0||s[0]>canvas.width||s[1]>canvas.height||s[1]<0;){s=[randomNum(0,canvas.width),randomNum(0,canvas.width)];let r=s[0]-e[1][0],c=s[1]-e[1][1],o=Math.sqrt(r*r+c*c);a=o}players.push(new Player(s[0],s[1],"paper"))}function i(){let s=[randomNum(0,canvas.width),randomNum(0,canvas.width)],a,i=s[0]-e[2][0],n=s[1]-e[2][1];for(a=Math.sqrt(i*i+n*n);a>t||s[0]<0||s[0]>canvas.width||s[1]>canvas.height||s[1]<0;){s=[randomNum(0,canvas.width),randomNum(0,canvas.width)];let r=s[0]-e[2][0],c=s[1]-e[2][1],o=Math.sqrt(r*r+c*c);a=o}players.push(new Player(s[0],s[1],"scissors"))}for(let n=0;n<Math.floor(population/3);n++)s(),a(),i()}else for(let r=0;r<Math.floor(population/3);r++)players.push(new Player(randomNum(0,canvas.width),randomNum(0,canvas.height),"rock")),players.push(new Player(randomNum(0,canvas.width),randomNum(0,canvas.height),"paper")),players.push(new Player(randomNum(0,canvas.width),randomNum(0,canvas.height),"scissors"));game()}function game(){if(ctx.clearRect(0,0,canvas.width,canvas.height),players.forEach(t=>{t.move(),t.change(),t.draw()}),ctx.font="15px Arial",ctx.fillText(`⛰️`,3,15),ctx.fillText(`📄`,4.5,33),ctx.fillText(`✂️`,4,52),ctx.fillText(`- ${players.filter(t=>"rock"==t.type).length}`,30,15),ctx.fillText(`- ${players.filter(t=>"paper"==t.type).length}`,30,33),ctx.fillText(`- ${players.filter(t=>"scissors"==t.type).length}`,30,52),players.length>0&&gameWon()[0]){let t=gameWon()[1];alert(`${t[0].toUpperCase()}${t.substring(1)} ${["⛰️","\uD83D\uDCC4","✂️"][["rock","paper","scissors"].indexOf(t)]} has won!`),control.style.display="inline",credits.style.display="inline";return}requestAnimationFrame(game)}function resize(){canvas.width=window.innerWidth,canvas.height=window.innerHeight}function setSpawn(t){let e=document.getElementsByTagName("input")[0],s=document.getElementsByTagName("input")[1];"factionsSpawn"==t.name?s.checked=!1:e.checked=!1,!1==t.checked&&(t.checked=!0),spawn=t.name}function setStrategy(t){let e=document.getElementsByTagName("input")[2],s=document.getElementsByTagName("input")[3];"attackHide"==t.name?s.checked=!1:e.checked=!1,!1==t.checked&&(t.checked=!0),strategy=t.name}function setPopulation(t){(!Number(t.value)||t.value.length>5)&&(t.value=t.value.slice(0,-1)),population=Number(t.value)}window.onload=function(){resize()};
